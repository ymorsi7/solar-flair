<!DOCTYPE html>
<html>
<head>
    <title>SolarSage AI - Powered by Google Gemini 2.5</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A revolutionary solar advisory platform utilizing Google Gemini 2.5 for multimodal analysis and recommendation">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #34c759;
            --secondary-color: #147efb;
            --accent-color: #fc6d26;
            --dark-color: #1c2b36;
            --light-color: #f8f9fa;
            --box-shadow: 0 8px 30px rgba(0,0,0,0.12);
            --card-radius: 16px;
            --gemini-blue: #4285F4;
            --gemini-red: #EA4335;
            --gemini-yellow: #FBBC05;
            --gemini-green: #34A853;
        }
        
        body { 
            padding-top: 20px; 
            background-color: var(--light-color);
            font-family: 'Poppins', sans-serif;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
        }
        
        .solar-header { 
            background: linear-gradient(135deg, var(--gemini-blue) 0%, var(--gemini-green) 100%);
            color: white;
            padding: 40px;
            border-radius: var(--card-radius);
            margin-bottom: 40px;
            box-shadow: var(--box-shadow);
            position: relative;
            overflow: hidden;
        }
        
        .gemini-dots {
            position: absolute;
            width: 100px;
            height: 20px;
            display: flex;
            justify-content: space-between;
        }
        
        .gemini-dots span {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .gemini-dots.top-right {
            top: 20px;
            right: 20px;
        }
        
        .gemini-dots.bottom-left {
            bottom: 20px;
            left: 20px;
        }
        
        .gemini-dot-1 {
            background-color: var(--gemini-blue);
            animation: pulse 2s infinite;
        }
        
        .gemini-dot-2 {
            background-color: var(--gemini-red);
            animation: pulse 2s infinite 0.5s;
        }
        
        .gemini-dot-3 {
            background-color: var(--gemini-yellow);
            animation: pulse 2s infinite 1s;
        }
        
        .gemini-dot-4 {
            background-color: var(--gemini-green);
            animation: pulse 2s infinite 1.5s;
        }
        
        @keyframes pulse {
            0% {
                transform: scale(1);
                opacity: 1;
            }
            50% {
                transform: scale(1.2);
                opacity: 0.7;
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }
        
        .solar-header::before {
            content: '';
            position: absolute;
            top: -50px;
            right: -50px;
            width: 200px;
            height: 200px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
        }
        
        .solar-header .roof-image {
            position: absolute;
            top: 0;
            right: 0;
            width: 100%;
            height: 100%;
            opacity: 0.15;
            object-fit: cover;
            z-index: 0;
        }
        
        .solar-header .content-wrapper {
            position: relative;
            z-index: 1;
        }
        
        .solar-header h1 {
            font-weight: 700;
            margin-bottom: 10px;
            font-size: 2.8rem;
        }
        
        .solar-header .lead {
            font-weight: 300;
            font-size: 1.2rem;
            opacity: 0.9;
        }
        
        .gemini-badge {
            display: inline-flex;
            align-items: center;
            background: rgba(255,255,255,0.2);
            border-radius: 30px;
            padding: 5px 15px;
            margin-top: 10px;
            backdrop-filter: blur(5px);
        }
        
        .gemini-badge img {
            height: 24px;
            margin-right: 8px;
        }
        
        .flash-animation {
            animation: flash-glow 3s infinite alternate;
        }
        
        @keyframes flash-glow {
            0% {
                text-shadow: 0 0 5px rgba(255,255,255,0.5);
            }
            100% {
                text-shadow: 0 0 20px rgba(255,255,255,0.9), 0 0 30px var(--primary-color);
            }
        }
        
        .floating {
            animation: float 3s ease-in-out infinite;
        }
        
        @keyframes float {
            0% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
            100% { transform: translateY(0px); }
        }
        
        .card {
            box-shadow: var(--box-shadow);
            margin-bottom: 30px;
            border: none;
            border-radius: var(--card-radius);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0,0,0,0.1);
        }
        
        .card-header {
            border-radius: var(--card-radius) var(--card-radius) 0 0 !important;
            font-weight: 600;
            padding: 15px 20px;
            border-bottom: none;
        }
        
        .card-body {
            padding: 25px;
        }
        
        .result-card {
            display: none;
            transition: all 0.3s ease;
        }
        
        .loader {
            display: none;
            border: 5px solid rgba(255,255,255,0.3);
            border-top: 5px solid var(--primary-color);
            border-radius: 50%;
            width: 60px;
            height: 60px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        #map {
            height: 320px;
            border-radius: var(--card-radius);
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 3px solid white;
            width: 100%;
            z-index: 1;
        }
        
        .verified-badge {
            background-color: var(--primary-color);
            color: white;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            margin-left: 8px;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        
        .pricing-card {
            text-align: center;
            transition: transform 0.3s, box-shadow 0.3s;
            height: 100%;
        }
        
        .pricing-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .price {
            font-size: 3rem;
            font-weight: 700;
            color: var(--dark-color);
            margin: 15px 0 5px;
        }
        
        .price-period {
            font-size: 0.9rem;
            color: #6c757d;
            margin-bottom: 20px;
        }
        
        .feature-list {
            list-style: none;
            padding-left: 0;
            margin: 25px 0;
            text-align: left;
        }
        
        .feature-list li {
            padding: 8px 0;
            border-bottom: 1px solid rgba(0,0,0,0.05);
            display: flex;
            align-items: center;
        }
        
        .feature-list li:last-child {
            border-bottom: none;
        }
        
        .feature-list li::before {
            content: "\f00c";
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            color: var(--primary-color);
            margin-right: 10px;
        }
        
        .step-indicator {
            display: flex;
            margin: 40px 0;
            padding: 0 15px;
        }
        
        .step {
            flex: 1;
            text-align: center;
            padding: 15px 10px;
            position: relative;
            color: #6c757d;
            transition: all 0.3s ease;
        }
        
        .step.active {
            color: var(--secondary-color);
            font-weight: 600;
        }
        
        .step:not(:last-child):after {
            content: "";
            position: absolute;
            top: 50%;
            right: 0;
            width: 100%;
            height: 3px;
            background: #e9ecef;
            z-index: -1;
        }
        
        .step-number {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            line-height: 40px;
            border-radius: 50%;
            background: #e9ecef;
            margin-bottom: 10px;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .step.active .step-number {
            background: var(--secondary-color);
            color: white;
            box-shadow: 0 5px 15px rgba(0,123,255,0.3);
        }

        .btn {
            padding: 12px 24px;
            font-weight: 500;
            border-radius: 8px;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-primary:hover {
            background-color: #0e6cda;
            border-color: #0e6cda;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(20,126,251,0.3);
        }

        .btn-success {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-success:hover {
            background-color: #2eb54b;
            border-color: #2eb54b;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52,199,89,0.3);
        }

        .btn-outline-primary {
            color: var(--secondary-color);
            border-color: var(--secondary-color);
        }

        .btn-outline-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(20,126,251,0.2);
        }
        
        .form-control {
            height: 50px;
            border-radius: 8px;
            padding-left: 20px;
            font-size: 1rem;
            border: 1px solid rgba(0,0,0,0.1);
            box-shadow: none;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: var(--secondary-color);
            box-shadow: 0 0 0 3px rgba(20,126,251,0.15);
        }
        
        .tab-content {
            padding: 25px 5px;
        }
        
        .chart-container {
            height: 300px;
            margin-top: 20px;
        }
        
        .nav-tabs {
            border-bottom: 2px solid #f0f0f0;
            margin-bottom: 15px;
        }
        
        .nav-tabs .nav-link {
            border: none;
            color: #666;
            font-weight: 500;
            padding: 10px 15px;
            border-radius: 0;
            transition: all 0.3s ease;
        }
        
        .nav-tabs .nav-link:hover {
            color: var(--secondary-color);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--secondary-color);
            background: transparent;
            border-bottom: 3px solid var(--secondary-color);
        }
        
        .list-group-item {
            border-radius: 8px;
            margin-bottom: 8px;
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        
        .list-group-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        
        .popular-plan {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--accent-color);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            z-index: 1;
        }
        
        .highlight-pulse {
            animation: highlight-pulse 2s infinite;
        }
        
        @keyframes highlight-pulse {
            0% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0.7);
            }
            70% {
                box-shadow: 0 0 0 15px rgba(52, 199, 89, 0);
            }
            100% {
                box-shadow: 0 0 0 0 rgba(52, 199, 89, 0);
            }
        }
        
        .banner {
            background: linear-gradient(135deg, #081f3e 0%, #1c4289 100%);
            border-radius: var(--card-radius);
            padding: 30px;
            margin-top: 50px;
            color: white;
            position: relative;
            overflow: hidden;
        }
        
        .banner::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: url('https://images.unsplash.com/photo-1509391366360-2e959784a276?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2072&q=80');
            background-size: cover;
            opacity: 0.15;
            z-index: 0;
        }
        
        .banner-content {
            position: relative;
            z-index: 1;
        }
        
        .scroll-top-btn {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background-color: var(--primary-color);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
            z-index: 999;
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .scroll-top-btn.show {
            opacity: 1;
        }
        
        .scroll-top-btn:hover {
            transform: translateY(-5px);
        }
        
        .map-custom-icon {
            background: none !important;
            border: none !important;
            box-shadow: none !important;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .map-custom-icon i {
            filter: drop-shadow(0px 2px 3px rgba(0,0,0,0.3));
        }
        
        .leaflet-popup-content {
            margin: 5px !important;
        }
        
        .leaflet-container {
            font-family: 'Poppins', sans-serif !important;
        }
        
        .voice-visualization {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 40px;
            gap: 5px;
        }
        
        .voice-visualization span {
            display: inline-block;
            width: 4px;
            height: 20px;
            background-color: var(--gemini-red);
            border-radius: 2px;
            animation: voice-wave 1.2s ease-in-out infinite;
        }
        
        .voice-visualization span:nth-child(2) {
            animation-delay: 0.2s;
            background-color: var(--gemini-blue);
        }
        
        .voice-visualization span:nth-child(3) {
            animation-delay: 0.4s;
            background-color: var(--gemini-yellow);
        }
        
        .voice-visualization span:nth-child(4) {
            animation-delay: 0.6s;
            background-color: var(--gemini-green);
        }
        
        .voice-visualization span:nth-child(5) {
            animation-delay: 0.8s;
            background-color: var(--gemini-red);
        }
        
        @keyframes voice-wave {
            0%, 100% {
                height: 10px;
            }
            50% {
                height: 30px;
            }
        }
        
        .gemini-thinking {
            padding: 15px;
            background-color: rgba(66, 133, 244, 0.1);
            border-radius: var(--card-radius);
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .gemini-thinking::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 50%;
            height: 100%;
            background: linear-gradient(
                90deg,
                rgba(255,255,255,0) 0%,
                rgba(255,255,255,0.5) 50%,
                rgba(255,255,255,0) 100%
            );
            animation: gemini-thinking-shine 2s infinite;
        }
        
        @keyframes gemini-thinking-shine {
            0% {
                left: -100%;
            }
            100% {
                left: 200%;
            }
        }

        .message {
            margin-bottom: 15px;
        }

        .message-content {
            max-width: 85%;
            position: relative;
        }

        .ai-message .message-content {
            background-color: rgba(66, 133, 244, 0.1);
            border-left: 3px solid var(--gemini-blue);
        }

        .user-message {
            display: flex;
            justify-content: flex-end;
        }

        .user-message .message-content {
            background-color: rgba(52, 168, 83, 0.1);
            border-right: 3px solid var(--gemini-green);
        }

        .message-thinking {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 8px;
        }

        .message-thinking-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background-color: var(--gemini-blue);
            animation: thinking-dot 1.4s infinite ease-in-out both;
        }

        .message-thinking-dot:nth-child(1) {
            animation-delay: -0.32s;
            background-color: var(--gemini-blue);
        }

        .message-thinking-dot:nth-child(2) {
            animation-delay: -0.16s;
            background-color: var(--gemini-red);
        }

        .message-thinking-dot:nth-child(3) {
            background-color: var(--gemini-yellow);
        }

        @keyframes thinking-dot {
            0%, 80%, 100% { 
                transform: scale(0);
            }
            40% { 
                transform: scale(1.0);
            }
        }

        .suggested-question {
            display: inline-block;
            color: var(--gemini-blue) !important;
            font-size: 0.85rem;
        }

        .suggested-question:hover {
            text-decoration: underline !important;
        }

        .gemini-icons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            grid-gap: 20px;
            max-width: 400px;
            margin: 0 auto;
        }

        .gemini-icon {
            background: rgba(255,255,255,0.15);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
        }

        .gemini-icon:hover {
            transform: translateY(-5px);
            background: rgba(255,255,255,0.25);
        }

        .gemini-icon span {
            display: block;
            margin-top: 10px;
            font-size: 14px;
        }

        .gemini-icon-1 {
            background: rgba(66, 133, 244, 0.7);
        }

        .gemini-icon-2 {
            background: rgba(234, 67, 53, 0.7);
        }

        .gemini-icon-3 {
            background: rgba(251, 188, 5, 0.7);
        }

        .gemini-icon-4 {
            background: rgba(52, 168, 83, 0.7);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="solar-header text-center">
            <img src="https://images.unsplash.com/photo-1508514177221-188b1cf16e9d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2072&q=80" alt="Solar roof" class="roof-image">
            <div class="gemini-dots top-right">
                <span class="gemini-dot-1"></span>
                <span class="gemini-dot-2"></span>
                <span class="gemini-dot-3"></span>
                <span class="gemini-dot-4"></span>
            </div>
            <div class="gemini-dots bottom-left">
                <span class="gemini-dot-1"></span>
                <span class="gemini-dot-2"></span>
                <span class="gemini-dot-3"></span>
                <span class="gemini-dot-4"></span>
            </div>
            <div class="content-wrapper">
                <div class="row align-items-center">
                    <div class="col-md-2 d-none d-md-block">
                        <i class="fas fa-solar-panel fa-5x floating" style="opacity: 0.9;"></i>
                    </div>
                    <div class="col-md-8">
                        <h1 class="flash-animation"><i class="fas fa-solar-panel d-inline d-md-none me-2"></i> SolarSage AI</h1>
                        <p class="lead">Intelligent solar solutions powered by data analysis and AI</p>
                        <div class="gemini-badge">
                            <img src="https://lh3.googleusercontent.com/JDFOyo903E9WGstK0YQzNOpJFHsCQVcUyXJQJ9OzRQDWcgNmJQ4s_cEVjwdCuJM7XZcUYj8=e14-rj-sc0xffffff-h130-w32" alt="Gemini logo"> 
                            Powered by Google Gemini 2.5
                        </div>
                    </div>
                    <div class="col-md-2 d-none d-md-block">
                        <i class="fas fa-bolt fa-5x floating" style="opacity: 0.9;"></i>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="card">
                    <div class="card-body">
                        <div class="d-flex align-items-center mb-4">
                            <span class="badge bg-primary me-2">Multimodal Input</span>
                            <h5 class="card-title mb-0 d-flex align-items-center">
                                <i class="fas fa-map-marker-alt me-2" style="color: var(--gemini-blue);"></i>
                                Analyze Your Property
                            </h5>
                        </div>
                        
                        <ul class="nav nav-tabs mb-3" id="inputTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="address-tab" data-bs-toggle="tab" data-bs-target="#address-tab-pane" type="button" role="tab">
                                    <i class="fas fa-home me-1"></i> Address
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="photo-tab" data-bs-toggle="tab" data-bs-target="#photo-tab-pane" type="button" role="tab">
                                    <i class="fas fa-camera me-1"></i> Roof Photo
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="voice-tab" data-bs-toggle="tab" data-bs-target="#voice-tab-pane" type="button" role="tab">
                                    <i class="fas fa-microphone me-1"></i> Voice Description
                                </button>
                            </li>
                        </ul>
                        
                        <div class="tab-content" id="inputTabContent">
                            <div class="tab-pane fade show active" id="address-tab-pane" role="tabpanel" tabindex="0">
                                <div class="input-group mb-3">
                                    <span class="input-group-text bg-white border-end-0">
                                        <i class="fas fa-home text-muted"></i>
                                    </span>
                                    <input type="text" class="form-control border-start-0" id="addressInput" 
                                           placeholder="e.g. 134 Denslow Ave, Los Angeles, CA">
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="photo-tab-pane" role="tabpanel" tabindex="0">
                                <div class="mb-3">
                                    <div class="d-flex flex-column align-items-center p-4 bg-light rounded-3 mb-3">
                                        <i class="fas fa-cloud-upload-alt fa-3x mb-3 text-primary"></i>
                                        <p class="mb-3 text-center">Upload a photo of your roof or property for Gemini-powered analysis</p>
                                        <label for="roofPhotoUpload" class="btn btn-outline-primary">
                                            <i class="fas fa-file-upload me-2"></i>Upload Photo
                                        </label>
                                        <input type="file" id="roofPhotoUpload" class="d-none" accept="image/*">
                                    </div>
                                    <div id="photoPreviewContainer" class="text-center d-none">
                                        <img id="photoPreview" class="img-fluid rounded mb-3 shadow-sm" style="max-height: 200px;" src="" alt="Roof photo preview">
                                        <p class="small text-muted">Gemini will analyze roof angle, shading, and potential solar panel placement</p>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="tab-pane fade" id="voice-tab-pane" role="tabpanel" tabindex="0">
                                <div class="mb-3">
                                    <div class="d-flex flex-column align-items-center p-4 bg-light rounded-3">
                                        <i id="micIcon" class="fas fa-microphone fa-3x mb-3 text-primary"></i>
                                        <p class="mb-3 text-center">Describe your property and requirements using your voice</p>
                                        <button id="startRecordingBtn" class="btn btn-outline-primary mb-2">
                                            <i class="fas fa-microphone-alt me-2"></i>Start Recording
                                        </button>
                                        <div id="recordingStatus" class="d-none">
                                            <span class="badge bg-danger p-2">Recording...</span>
                                            <div class="mt-2 mb-2">
                                                <div class="voice-visualization">
                                                    <span></span><span></span><span></span><span></span><span></span>
                                                </div>
                                            </div>
                                            <button id="stopRecordingBtn" class="btn btn-sm btn-danger">
                                                <i class="fas fa-stop-circle me-1"></i>Stop
                                            </button>
                                        </div>
                                        <p id="transcriptionText" class="text-muted small mt-2 d-none"></p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-grid">
                            <button class="btn btn-primary" id="assessBtn">
                                <i class="fas fa-search-location me-2"></i>Analyze with Gemini 2.5
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="step-indicator" id="stepIndicator">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div><i class="fas fa-map-marker-alt me-1"></i>Input</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div><i class="fas fa-chart-line me-1"></i>Assessment</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div><i class="fas fa-file-contract me-1"></i>Proposal</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div><i class="fas fa-hard-hat me-1"></i>Installers</div>
            </div>
        </div>
        
        <div class="loader" id="loader"></div>
        
        <div class="gemini-thinking d-none" id="geminiThinking">
            <div class="d-flex align-items-center mb-3">
                <img src="https://lh3.googleusercontent.com/JDFOyo903E9WGstK0YQzNOpJFHsCQVcUyXJQJ9OzRQDWcgNmJQ4s_cEVjwdCuJM7XZcUYj8=e14-rj-sc0xffffff-h130-w32" alt="Gemini logo" style="height: 24px;" class="me-2">
                <h6 class="mb-0">Gemini is analyzing your property...</h6>
            </div>
            <div class="small" id="thinkingSteps">
                <div class="mb-1">• Loading satellite imagery...</div>
                <div class="mb-1">• Calculating solar radiation levels...</div>
                <div class="mb-1">• Analyzing roof orientation and pitch...</div>
                <div class="mb-1">• Estimating potential system size...</div>
                <div class="mb-1">• Calculating financial projections...</div>
            </div>
        </div>
        
        <div class="row result-card" id="assessmentResult">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-sun fa-spin-pulse me-2"></i>
                            <h5 class="mb-0">Gemini Solar Assessment</h5>
                            <span class="ms-auto badge bg-success">99.7% Accuracy</span>
                        </div>
                    </div>
                    <div class="card-body">
                        <div class="mb-4 p-3 bg-light rounded-3 border-start border-4 border-warning">
                            <div class="d-flex">
                                <div class="me-3">
                                    <i class="fas fa-lightbulb text-warning fa-2x"></i>
                                </div>
                                <div>
                                    <h6 class="mb-1">Gemini AI Insight</h6>
                                    <p class="mb-0" id="geminiInsight">Based on my multimodal analysis of your property at 134 Denslow Ave, I've determined this location has excellent solar potential. The south-facing roof sections receive optimal sunlight exposure with minimal shading from nearby trees or structures. I estimate you could fit a 5.0kW system that would offset approximately 85% of your current electricity usage.</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <div class="position-relative mb-3">
                                    <div id="map"></div>
                                    <div class="position-absolute" style="top: 10px; right: 10px; z-index: 1000;">
                                        <span class="badge bg-light text-dark p-2 shadow-sm">
                                            <i class="fas fa-satellite text-primary me-1"></i> Satellite View
                                        </span>
                                    </div>
                                </div>
                                <div class="text-center py-2 bg-light rounded-3 d-flex align-items-center justify-content-center" id="addressDisplay" style="font-weight: 500;">
                                    <i class="fas fa-map-marker-alt text-danger me-2"></i>
                                    <span>134 Denslow Ave, Los Angeles CA 90049-3221</span>
                                </div>
                                
                                <div class="mt-4 p-3 bg-light rounded-3">
                                    <h6 class="mb-3"><i class="fas fa-sun text-warning me-2"></i>Solar Suitability Score</h6>
                                    <div class="progress mb-2" style="height: 10px;">
                                        <div class="progress-bar bg-success progress-bar-striped progress-bar-animated" role="progressbar" style="width: 92%;" aria-valuenow="92" aria-valuemin="0" aria-valuemax="100"></div>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span class="badge bg-light text-dark">Poor</span>
                                        <span class="badge bg-success">Excellent (92%)</span>
                                    </div>
                                </div>
                                
                                <div class="mt-4 p-3 bg-light rounded-3">
                                    <h6 class="mb-2">
                                        <i class="fas fa-robot text-primary me-2"></i>
                                        Multimodal Analysis
                                    </h6>
                                    <div class="row mt-3">
                                        <div class="col-6">
                                            <div class="d-flex align-items-center mb-3">
                                                <div class="rounded-circle bg-primary d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">
                                                    <i class="fas fa-image text-white small"></i>
                                                </div>
                                                <span class="small fw-medium">Visual Analysis</span>
                                            </div>
                                            <ul class="small ps-4 mb-0">
                                                <li>Roof orientation: South</li>
                                                <li>Pitch angle: 22°</li>
                                                <li>Shade factors: Minimal</li>
                                            </ul>
                                        </div>
                                        <div class="col-6">
                                            <div class="d-flex align-items-center mb-3">
                                                <div class="rounded-circle bg-success d-flex align-items-center justify-content-center me-2" style="width: 24px; height: 24px;">
                                                    <i class="fas fa-database text-white small"></i>
                                                </div>
                                                <span class="small fw-medium">Data Analysis</span>
                                            </div>
                                            <ul class="small ps-4 mb-0">
                                                <li>Local insolation: High</li>
                                                <li>Weather patterns: Ideal</li>
                                                <li>Energy profile: Matching</li>
                                            </ul>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab">
                                            <i class="fas fa-solar-panel me-1"></i>System
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial" type="button" role="tab">
                                            <i class="fas fa-dollar-sign me-1"></i>Financial
                                        </button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="environmental-tab" data-bs-toggle="tab" data-bs-target="#environmental" type="button" role="tab">
                                            <i class="fas fa-leaf me-1"></i>Environmental
                                        </button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="myTabContent">
                                    <div class="tab-pane fade show active" id="system" role="tabpanel">
                                        <div class="row">
                                            <div class="col-6">
                                                <div class="card bg-light border-0 mb-3 text-center">
                                                    <div class="card-body p-3">
                                                        <div class="text-muted mb-1 small">Annual Production</div>
                                                        <div><span id="annualKwh" class="fs-4 fw-bold text-primary">7,500</span> kWh</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card bg-light border-0 mb-3 text-center">
                                                    <div class="card-body p-3">
                                                        <div class="text-muted mb-1 small">System Size</div>
                                                        <div><span id="systemSize" class="fs-4 fw-bold text-primary">5.0</span> kW</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card bg-light border-0 mb-3 text-center">
                                                    <div class="card-body p-3">
                                                        <div class="text-muted mb-1 small">Panel Count</div>
                                                        <div><span id="panelCount" class="fs-4 fw-bold text-primary">14</span> panels</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card bg-light border-0 mb-3 text-center">
                                                    <div class="card-body p-3">
                                                        <div class="text-muted mb-1 small">Optimal Tilt</div>
                                                        <div><span id="bestTilt" class="fs-4 fw-bold text-primary">20°</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mt-3">
                                            <div class="d-flex align-items-center mb-2">
                                                <i class="fas fa-check-circle me-2 text-success"></i>
                                                <strong>Recommended Panel Type:</strong>
                                                <span id="bestMaterial" class="ms-2">Monocrystalline</span>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-home me-2 text-success"></i>
                                                <strong>Roof Details:</strong>
                                                <span class="ms-2"><span id="roofArea">85</span> m² usable area, <span id="shadePct">15</span>% shade</span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="financial" role="tabpanel">
                                        <div class="row mb-3 mt-1">
                                            <div class="col-12 col-md-6 mb-3">
                                                <div class="card h-100 bg-light border-0">
                                                    <div class="card-body p-3">
                                                        <h6 class="text-center text-muted mb-3 small">System Investment</h6>
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span>System Cost:</span>
                                                            <span class="fw-bold">$<span id="systemCost">14,750</span></span>
                                                        </div>
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span>Incentives:</span>
                                                            <span class="fw-bold text-success">$<span id="incentives">4,425</span></span>
                                                        </div>
                                                        <hr>
                                                        <div class="d-flex justify-content-between">
                                                            <span>Net Cost:</span>
                                                            <span class="fw-bold fs-5">$<span id="netCost">10,325</span></span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-md-6 mb-3">
                                                <div class="card h-100 bg-light border-0">
                                                    <div class="card-body p-3">
                                                        <h6 class="text-center text-muted mb-3 small">Return on Investment</h6>
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span>Annual Savings:</span>
                                                            <span class="fw-bold text-success">$<span id="annualSavings">1,725</span></span>
                                                        </div>
                                                        <div class="d-flex justify-content-between mb-2">
                                                            <span>Payback Period:</span>
                                                            <span class="fw-bold"><span id="paybackYears">6.0</span> years</span>
                                                        </div>
                                                        <hr>
                                                        <div class="d-flex justify-content-between">
                                                            <span>25-Year ROI:</span>
                                                            <span class="fw-bold fs-5 text-primary"><span id="roi">319</span>%</span>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="card bg-light border-0 p-3">
                                            <div class="d-flex align-items-center">
                                                <div class="bg-success p-2 rounded-circle me-3 d-flex align-items-center justify-content-center" style="width: 50px; height: 50px;">
                                                    <i class="fas fa-piggy-bank text-white fa-lg"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-1">Solar Investment Benefits</h6>
                                                    <p class="mb-0 text-muted small">Your solar system will pay for itself in <strong id="paybackYears2">6.0</strong> years, saving you over <strong>$40,000</strong> in the next 25 years.</p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="environmental" role="tabpanel">
                                        <div class="text-center bg-light rounded-3 p-3 mb-3">
                                            <div class="text-muted small mb-1">Annual CO₂ Reduction</div>
                                            <div class="d-flex align-items-center justify-content-center">
                                                <i class="fas fa-cloud-sun text-success me-2 fa-lg"></i>
                                                <span class="fs-3 fw-bold text-success"><span id="co2Reduction">5,250</span> kg</span>
                                            </div>
                                        </div>
                                        <h6 class="mb-3">Environmental Impact Equivalent To:</h6>
                                        <div class="row mb-4">
                                            <div class="col-6">
                                                <div class="card bg-light border-0 text-center h-100">
                                                    <div class="card-body p-3">
                                                        <i class="fas fa-tree text-success fa-2x mb-2"></i>
                                                        <div><span id="treesEquivalent" class="fs-4 fw-bold">242</span></div>
                                                        <div class="small text-muted">trees planted yearly</div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-6">
                                                <div class="card bg-light border-0 text-center h-100">
                                                    <div class="card-body p-3">
                                                        <i class="fas fa-car text-success fa-2x mb-2"></i>
                                                        <div><span id="carEquivalent" class="fs-4 fw-bold">1.1</span></div>
                                                        <div class="small text-muted">cars taken off the road</div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="chart-container">
                                            <canvas id="environmentalChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr class="my-4">
                        
                        <div class="row mt-4">
                            <div class="col-12">
                                <h5 class="mb-3">
                                    <div class="d-flex align-items-center">
                                        <i class="fas fa-clipboard-list me-2 text-primary"></i>
                                        <span>Next Steps</span>
                                        <div class="ms-auto flash-animation">
                                            <span class="badge bg-danger">Limited Time Offer</span>
                                        </div>
                                    </div>
                                </h5>
                                <div id="nextSteps" class="list-group"></div>
                            </div>
                        </div>
                        
                        <div class="card mt-4 border-primary">
                            <div class="card-header bg-primary text-white py-3">
                                <div class="d-flex align-items-center">
                                    <img src="https://lh3.googleusercontent.com/JDFOyo903E9WGstK0YQzNOpJFHsCQVcUyXJQJ9OzRQDWcgNmJQ4s_cEVjwdCuJM7XZcUYj8=e14-rj-sc0xffffff-h130-w32" alt="Gemini logo" class="me-2" style="height: 24px;">
                                    <h5 class="mb-0">Ask Gemini About Your Solar Assessment</h5>
                                </div>
                            </div>
                            <div class="card-body p-0">
                                <div id="chatMessages" class="p-3" style="max-height: 300px; overflow-y: auto;">
                                    <div class="message ai-message mb-3">
                                        <div class="message-content p-3 rounded-3 bg-light">
                                            <div class="d-flex align-items-center mb-2">
                                                <div class="message-avatar bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 30px; height: 30px;">
                                                    <i class="fas fa-robot text-white small"></i>
                                                </div>
                                                <strong>Gemini Solar Assistant</strong>
                                            </div>
                                            <p class="mb-0">Hello! I'm your Gemini-powered solar advisor. I've analyzed your property and created a detailed assessment. Feel free to ask me any questions about solar installation, financial benefits, or environmental impact for your specific location.</p>
                                        </div>
                                    </div>
                                </div>
                                <div class="p-3 border-top">
                                    <div class="input-group">
                                        <input type="text" id="userQuestion" class="form-control" placeholder="Ask a question about your solar assessment...">
                                        <button class="btn btn-primary" id="askGeminiBtn">
                                            <i class="fas fa-paper-plane"></i>
                                        </button>
                                    </div>
                                    <div class="mt-2 small text-muted">
                                        <span class="fst-italic">Suggested questions:</span>
                                        <a href="#" class="suggested-question text-decoration-none ms-2">What solar panel type is best for me?</a>
                                        <a href="#" class="suggested-question text-decoration-none ms-2">How long until I break even?</a>
                                        <a href="#" class="suggested-question text-decoration-none ms-2">How does weather affect my system?</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button class="btn btn-success btn-lg me-2" id="proposalBtn">
                                <i class="fas fa-file-contract me-2"></i>Generate Proposal
                            </button>
                            <button class="btn btn-outline-primary btn-lg" id="findInstallersBtn">
                                <i class="fas fa-hard-hat me-2"></i>Find Installers
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row result-card" id="pricingPlans">
            <div class="col-12 mb-4">
                <div class="text-center position-relative overflow-hidden py-3">
                    <div class="position-absolute" style="left: 0; top: 50%; transform: translateY(-50%);">
                        <i class="fas fa-sun fa-3x text-warning opacity-25"></i>
                    </div>
                    <div class="position-absolute" style="right: 0; top: 50%; transform: translateY(-50%);">
                        <i class="fas fa-sun fa-3x text-warning opacity-25"></i>
                    </div>
                    <h3 class="mb-2 flash-animation" style="font-weight: 700;">Choose Your Plan</h3>
                    <p class="text-muted">Unlock premium Gemini 2.5 features with our paid plans</p>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card">
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <i class="fas fa-leaf fa-3x text-success opacity-75"></i>
                        </div>
                        <h5 class="card-title text-center">Free</h5>
                        <p class="price">$0</p>
                        <p class="price-period">forever</p>
                        <ul class="feature-list">
                            <li>Basic solar assessment</li>
                            <li>Gemini-powered ROI calculation</li>
                            <li>3 assessments per month</li>
                            <li class="text-muted text-decoration-line-through">Advanced multimodal analysis</li>
                            <li class="text-muted text-decoration-line-through">Personalized AI advisor</li>
                        </ul>
                        <button class="btn btn-outline-primary mt-3 w-100">Current Plan</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card" style="border: 2px solid var(--primary-color); transform: scale(1.05);">
                    <div class="popular-plan">Most Popular</div>
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <i class="fas fa-solar-panel fa-3x text-primary opacity-75 floating"></i>
                        </div>
                        <h5 class="card-title text-center">Premium</h5>
                        <p class="price">$9.99</p>
                        <p class="price-period">per month</p>
                        <ul class="feature-list">
                            <li>Advanced Gemini 2.5 assessment</li>
                            <li>Multimodal property analysis</li>
                            <li>Custom proposal generation</li>
                            <li>Personalized AI solar advisor</li>
                            <li>Unlimited assessments</li>
                        </ul>
                        <button class="btn btn-primary mt-3 w-100 flash-animation" id="upgradePremiumBtn">Upgrade Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card">
                    <div class="card-body">
                        <div class="text-center mb-3">
                            <i class="fas fa-building fa-3x text-secondary opacity-75"></i>
                        </div>
                        <h5 class="card-title text-center">Business</h5>
                        <p class="price">$49.99</p>
                        <p class="price-period">per month</p>
                        <ul class="feature-list">
                            <li>Everything in Premium</li>
                            <li>Gemini API for bulk assessments</li>
                            <li>Advanced financial modeling</li>
                            <li>System monitoring with AI insights</li>
                            <li>White-label reports & API access</li>
                        </ul>
                        <button class="btn btn-outline-primary mt-3 w-100">Contact Sales</button>
                    </div>
                </div>
            </div>
            <div class="col-12 mt-5">
                <div class="card bg-gradient-light border-0">
                    <div class="card-body p-4">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <div class="d-flex align-items-center mb-2">
                                    <div class="bg-success rounded-circle p-2 me-3">
                                        <i class="fas fa-check text-white"></i>
                                    </div>
                                    <h5 class="mb-0">Powered by Gemini 2.5</h5>
                                </div>
                                <p class="text-muted mb-0">Utilizing Google's most advanced multimodal AI for unmatched accuracy in solar assessment and planning.</p>
                            </div>
                            <div class="col-md-4 text-center text-md-end mt-3 mt-md-0">
                                <a href="#" class="btn btn-outline-success">Learn More</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="banner">
            <div class="banner-content">
                <div class="row align-items-center">
                    <div class="col-md-7">
                        <h3 class="mb-3 flash-animation">Powered by Google Gemini 2.5</h3>
                        <p class="mb-4">Leveraging the most advanced multimodal AI to revolutionize solar planning with unprecedented accuracy. Our Gemini-powered platform analyzes images, processes voice data, and provides intelligent recommendations tailored to your specific property.</p>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-light" id="scrollToTopBtn">
                                <i class="fas fa-arrow-up me-2"></i>Get Started
                            </button>
                            <a href="https://aistudio.google.com" target="_blank" class="btn btn-outline-light">
                                <i class="fas fa-external-link-alt me-2"></i>Learn About Gemini 2.5
                            </a>
                        </div>
                    </div>
                    <div class="col-md-5 text-center">
                        <div class="position-relative">
                            <div class="gemini-icons">
                                <div class="gemini-icon gemini-icon-1">
                                    <i class="fas fa-image fa-2x text-white"></i>
                                    <span>Image Analysis</span>
                                </div>
                                <div class="gemini-icon gemini-icon-2">
                                    <i class="fas fa-microphone fa-2x text-white"></i>
                                    <span>Voice Processing</span>
                                </div>
                                <div class="gemini-icon gemini-icon-3">
                                    <i class="fas fa-brain fa-2x text-white"></i>
                                    <span>Advanced Reasoning</span>
                                </div>
                                <div class="gemini-icon gemini-icon-4">
                                    <i class="fas fa-comment-dots fa-2x text-white"></i>
                                    <span>Conversational AI</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="scroll-top-btn" id="mainScrollTopBtn">
        <i class="fas fa-arrow-up"></i>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // DOM Elements
            const addressInput = document.getElementById('addressInput');
            const assessBtn = document.getElementById('assessBtn');
            const proposalBtn = document.getElementById('proposalBtn');
            const findInstallersBtn = document.getElementById('findInstallersBtn');
            const upgradePremiumBtn = document.getElementById('upgradePremiumBtn');
            const scrollToTopBtn = document.getElementById('scrollToTopBtn');
            const mainScrollTopBtn = document.getElementById('mainScrollTopBtn');
            const loader = document.getElementById('loader');
            const geminiThinking = document.getElementById('geminiThinking');
            const assessmentResult = document.getElementById('assessmentResult');
            const pricingPlans = document.getElementById('pricingPlans');
            const roofPhotoUpload = document.getElementById('roofPhotoUpload');
            const photoPreview = document.getElementById('photoPreview');
            const photoPreviewContainer = document.getElementById('photoPreviewContainer');
            const startRecordingBtn = document.getElementById('startRecordingBtn');
            const stopRecordingBtn = document.getElementById('stopRecordingBtn');
            const recordingStatus = document.getElementById('recordingStatus');
            const transcriptionText = document.getElementById('transcriptionText');
            const userQuestion = document.getElementById('userQuestion');
            const askGeminiBtn = document.getElementById('askGeminiBtn');
            const chatMessages = document.getElementById('chatMessages');
            const suggestedQuestions = document.querySelectorAll('.suggested-question');
            
            // Set up event listeners
            assessBtn.addEventListener('click', runAssessment);
            proposalBtn.addEventListener('click', showPricingPlans);
            findInstallersBtn.addEventListener('click', showPricingPlans);
            upgradePremiumBtn.addEventListener('click', function() {
                alert('This is a demo for the hackathon. In a real implementation, this would process a payment and upgrade your account to access all Gemini 2.5 features.');
            });
            
            scrollToTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            mainScrollTopBtn.addEventListener('click', function() {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            });
            
            // Show/hide scroll to top button
            window.addEventListener('scroll', function() {
                if (window.pageYOffset > 300) {
                    mainScrollTopBtn.classList.add('show');
                } else {
                    mainScrollTopBtn.classList.remove('show');
                }
            });
            
            // Handle roof photo upload
            roofPhotoUpload.addEventListener('change', function(event) {
                const file = event.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        photoPreview.src = e.target.result;
                        photoPreviewContainer.classList.remove('d-none');
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            // Handle voice recording
            startRecordingBtn.addEventListener('click', function() {
                startRecordingBtn.classList.add('d-none');
                recordingStatus.classList.remove('d-none');
                
                // Simulate voice recording (In a real implementation, this would use Web Speech API)
                setTimeout(() => {
                    stopRecording();
                }, 5000);
            });
            
            stopRecordingBtn.addEventListener('click', stopRecording);
            
            function stopRecording() {
                startRecordingBtn.classList.remove('d-none');
                recordingStatus.classList.add('d-none');
                transcriptionText.classList.remove('d-none');
                transcriptionText.textContent = "I have a two-story house in Los Angeles with a south-facing roof. I'm interested in solar panels that can cover about 80% of my electricity needs.";
            }
            
            // Handle chat with Gemini
            askGeminiBtn.addEventListener('click', askGemini);
            userQuestion.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    askGemini();
                }
            });
            
            suggestedQuestions.forEach(question => {
                question.addEventListener('click', function(e) {
                    e.preventDefault();
                    userQuestion.value = this.textContent;
                    askGemini();
                });
            });
            
            function askGemini() {
                const question = userQuestion.value.trim();
                if (!question) return;
                
                // Add user message to chat
                addMessageToChat('user', question);
                userQuestion.value = '';
                
                // Add thinking indicator
                const thinkingId = 'thinking-' + Date.now();
                addThinkingIndicator(thinkingId);
                
                // Simulate Gemini API response (In a real implementation, this would call the Gemini API)
                setTimeout(() => {
                    // Remove thinking indicator
                    document.getElementById(thinkingId).remove();
                    
                    // Generate response based on question
                    let response;
                    if (question.toLowerCase().includes('panel type') || question.toLowerCase().includes('best for me')) {
                        response = "Based on my analysis of your roof's orientation, sun exposure, and local climate data, I recommend monocrystalline panels for your installation. These offer the highest efficiency (20-22%) in the limited space available on your south-facing roof sections. While they cost about 20% more than polycrystalline options, the increased energy production will result in a better long-term ROI for your specific property.";
                    } else if (question.toLowerCase().includes('break even') || question.toLowerCase().includes('payback')) {
                        response = "After analyzing your property's solar potential, local electricity rates ($0.22/kWh with 6% annual increases), and available incentives including the 30% federal tax credit, I project your system will break even in approximately 4.3 years. Your 25-year net savings are estimated at $42,750, representing a 319% return on your initial investment.";
                    } else if (question.toLowerCase().includes('weather')) {
                        response = "I've analyzed 10 years of historical weather data for your location. Your area averages 284 sunny days per year, well above the national average. Even factoring in occasional marine layer in mornings and typical Southern California weather patterns, your system should produce approximately 7,500 kWh annually. I've built in a 5% buffer for unusually cloudy periods in my financial projections.";
                    } else {
                        response = "I've analyzed your property at 134 Denslow Ave and can confidently say it's excellent for solar installation. Based on your roof orientation, shading analysis, and local climate data, a 5kW system would generate approximately 7,500 kWh annually, offsetting about 85% of typical electricity usage for a home of your size. With current incentives, your payback period would be approximately 4.3 years.";
                    }
                    
                    // Add Gemini response to chat
                    addMessageToChat('ai', response);
                    
                    // Scroll to bottom of chat
                    chatMessages.scrollTop = chatMessages.scrollHeight;
                }, 2000);
            }
            
            function addMessageToChat(sender, content) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${sender}-message mb-3`;
                
                let html;
                if (sender === 'user') {
                    html = `
                        <div class="message-content p-3 rounded-3 ms-auto">
                            <div class="d-flex align-items-center justify-content-between mb-2">
                                <strong>You</strong>
                                <small class="text-muted ms-2">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                            </div>
                            <p class="mb-0">${content}</p>
                        </div>
                    `;
                } else {
                    html = `
                        <div class="message-content p-3 rounded-3">
                            <div class="d-flex align-items-center mb-2">
                                <div class="message-avatar bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 30px; height: 30px;">
                                    <i class="fas fa-robot text-white small"></i>
                                </div>
                                <strong>Gemini Solar Assistant</strong>
                                <small class="text-muted ms-2">${new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</small>
                            </div>
                            <p class="mb-0">${content}</p>
                        </div>
                    `;
                }
                
                messageDiv.innerHTML = html;
                chatMessages.appendChild(messageDiv);
            }
            
            function addThinkingIndicator(id) {
                const thinkingDiv = document.createElement('div');
                thinkingDiv.className = 'message ai-message mb-3';
                thinkingDiv.id = id;
                thinkingDiv.innerHTML = `
                    <div class="message-content p-3 rounded-3" style="width: fit-content;">
                        <div class="message-thinking">
                            <div class="message-thinking-dot"></div>
                            <div class="message-thinking-dot"></div>
                            <div class="message-thinking-dot"></div>
                        </div>
                    </div>
                `;
                chatMessages.appendChild(thinkingDiv);
                chatMessages.scrollTop = chatMessages.scrollHeight;
            }
            
            // Pre-fill the address for demo purposes
            addressInput.value = "134 Denslow Ave, Los Angeles, CA";
            
            async function runAssessment() {
                // Get input from active tab
                const activeTab = document.querySelector('#inputTabs .nav-link.active');
                let inputType = activeTab ? activeTab.id : 'address-tab';
                
                let address = addressInput.value.trim();
                if (inputType === 'address-tab' && !address) {
                    alert('Please enter an address');
                    return;
                }
                
                // Show thinking indicator
                loader.style.display = 'none';
                geminiThinking.classList.remove('d-none');
                assessmentResult.style.display = 'none';
                pricingPlans.style.display = 'none';
                
                // Update step indicator
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step2').classList.add('active');
                
                // Simulate API call with a delay
                const thinkingSteps = document.querySelectorAll('#thinkingSteps div');
                
                // Animate thinking steps one by one
                for (let i = 0; i < thinkingSteps.length; i++) {
                    await new Promise(resolve => {
                        setTimeout(() => {
                            thinkingSteps[i].innerHTML = thinkingSteps[i].innerHTML.replace('•', '✓');
                            thinkingSteps[i].style.color = 'var(--gemini-green)';
                            resolve();
                        }, 800);
                    });
                }
                
                // Add final analyzing step with delay
                await new Promise(resolve => {
                    setTimeout(() => {
                        const finalStep = document.createElement('div');
                        finalStep.innerHTML = '✓ AI analysis complete! Generating report...';
                        finalStep.style.color = 'var(--gemini-green)';
                        document.getElementById('thinkingSteps').appendChild(finalStep);
                        resolve();
                    }, 1000);
                });
                
                // Show results after all steps complete
                await new Promise(resolve => {
                    setTimeout(() => {
                        const results = {
                            std: "134 Denslow Ave, Los Angeles CA 90049-3221",
                            lat: 34.0735812,
                            lng: -118.4576362,
                            annualKwh: 7500,
                            paybackYears: 4.3,
                            bestTilt: 20,
                            bestMaterial: "Monocrystalline",
                            melissaVerified: true,
                            // Additional data for the enhanced UI
                            systemSize: 5.0,
                            panelCount: 14,
                            roofDetails: {
                                usableAreaM2: 85,
                                shadePct: 15
                            },
                            financials: {
                                systemCost: 14750,
                                incentives: 4425,
                                netCost: 10325,
                                annualSavings: 1725,
                                roi25Year: 319
                            },
                            environmental: {
                                co2ReductionKg: 5250,
                                treesEquivalent: 242,
                                carEquivalent: 1.1
                            },
                            nextSteps: [
                                {
                                    action: "Generate Custom Proposal",
                                    description: "Create a detailed solar proposal with system design and financials",
                                    toolId: "solar-proposal"
                                },
                                {
                                    action: "Find Local Installers",
                                    description: "Connect with top-rated solar installers in your area",
                                    toolId: "solar-installer"
                                },
                                {
                                    action: "Explore Financing Options",
                                    description: "Compare solar loans, leases, and PPAs",
                                    toolId: "solar-financing"
                                }
                            ]
                        };
                        
                        displayResults(results);
                        
                        // Hide loader
                        geminiThinking.classList.add('d-none');
                        assessmentResult.style.display = 'block';
                        
                        // Smooth scroll to results
                        setTimeout(() => {
                            assessmentResult.scrollIntoView({ behavior: 'smooth' });
                        }, 100);
                        
                        resolve();
                    }, 1000);
                });
            }
            
            function displayResults(results) {
                // Display address with Melissa verification badge
                document.getElementById('addressDisplay').innerHTML = 
                    `<i class="fas fa-map-marker-alt text-danger me-2"></i><span>${results.std}${results.melissaVerified ? ' <span class="verified-badge"><i class="fas fa-check-circle me-1"></i>Verified</span>' : ''}</span>`;
                
                // Display system details
                document.getElementById('annualKwh').textContent = results.annualKwh.toLocaleString();
                document.getElementById('systemSize').textContent = results.systemSize;
                document.getElementById('panelCount').textContent = results.panelCount;
                document.getElementById('bestTilt').textContent = results.bestTilt;
                document.getElementById('bestMaterial').textContent = results.bestMaterial;
                document.getElementById('roofArea').textContent = results.roofDetails.usableAreaM2;
                document.getElementById('shadePct').textContent = results.roofDetails.shadePct;
                
                // Update second payback period display
                document.getElementById('paybackYears2').textContent = results.paybackYears;
                
                // Display financials
                document.getElementById('systemCost').textContent = results.financials.systemCost.toLocaleString();
                document.getElementById('incentives').textContent = results.financials.incentives.toLocaleString();
                document.getElementById('netCost').textContent = results.financials.netCost.toLocaleString();
                document.getElementById('annualSavings').textContent = results.financials.annualSavings.toLocaleString();
                document.getElementById('paybackYears').textContent = results.paybackYears;
                document.getElementById('roi').textContent = results.financials.roi25Year;
                
                // Display environmental impact
                document.getElementById('co2Reduction').textContent = results.environmental.co2ReductionKg.toLocaleString();
                document.getElementById('treesEquivalent').textContent = results.environmental.treesEquivalent;
                document.getElementById('carEquivalent').textContent = results.environmental.carEquivalent;
                
                // Display next steps
                const nextStepsContainer = document.getElementById('nextSteps');
                nextStepsContainer.innerHTML = '';
                
                results.nextSteps.forEach((step, index) => {
                    const item = document.createElement('a');
                    item.className = 'list-group-item list-group-item-action';
                    if (index === 0) item.classList.add('highlight-pulse');
                    item.href = '#';
                    item.innerHTML = `
                        <div class="d-flex align-items-center">
                            <div class="me-3 text-center">
                                <div class="bg-light rounded-circle p-2" style="width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;">
                                    <i class="fas fa-${index === 0 ? 'file-contract text-success' : index === 1 ? 'hard-hat text-primary' : 'money-bill-wave text-warning'}"></i>
                                </div>
                            </div>
                            <div>
                                <strong>${step.action}</strong>
                                <div class="text-muted small">${step.description}</div>
                            </div>
                            <i class="fas fa-chevron-right ms-auto text-muted"></i>
                        </div>
                    `;
                    item.addEventListener('click', showPricingPlans);
                    nextStepsContainer.appendChild(item);
                });
                
                // Initialize map with a slight delay to ensure container is rendered
                setTimeout(() => {
                    // Clear any existing map instance
                    const mapContainer = document.getElementById('map');
                    mapContainer.innerHTML = '';
                    
                    const map = L.map('map', {
                        attributionControl: true,
                        zoomControl: true
                    }).setView([results.lat, results.lng], 18);  // Increased zoom level
                    
                    // Use a different tile provider for better loading
                    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19,
                        crossOrigin: true
                    }).addTo(map);
                    
                    // Add a fallback tile layer in case the primary one fails
                    const fallbackTileLayer = L.tileLayer('https://tile.thunderforest.com/neighbourhood/{z}/{x}/{y}.png?apikey=6170aad10dfd42a38d4d8c709a536f38', {
                        attribution: '&copy; <a href="https://www.thunderforest.com/">Thunderforest</a>, &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',
                        maxZoom: 19,
                        opacity: 0,
                        crossOrigin: true
                    }).addTo(map);
                    
                    // If primary tiles fail to load, show fallback tiles
                    setTimeout(() => {
                        const mapTiles = document.querySelectorAll('.leaflet-tile');
                        if (mapTiles.length < 4) {  // Not enough tiles loaded
                            fallbackTileLayer.setOpacity(1);
                        }
                    }, 2000);
                    
                    // Add a more visible marker
                    const marker = L.marker([results.lat, results.lng], {
                        icon: L.divIcon({
                            html: '<i class="fas fa-home fa-2x text-danger"></i>',
                            iconSize: [20, 20],
                            className: 'map-custom-icon'
                        })
                    }).addTo(map);
                    
                    marker.bindPopup(`
                        <div class="p-2">
                            <strong>${results.std}</strong><br>
                            <span class="small text-muted">Perfect for solar!</span>
                        </div>
                    `).openPopup();
                    
                    // Force map to update its container size
                    map.invalidateSize();
                }, 300);
                
                // Create environmental impact chart
                const ctx = document.getElementById('environmentalChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Year 1', 'Year 5', 'Year 10', 'Year 15', 'Year 20', 'Year 25'],
                        datasets: [{
                            label: 'CO₂ Reduction (tons)',
                            data: [5.25, 26.25, 52.5, 78.75, 105, 131.25],
                            backgroundColor: 'rgba(52, 199, 89, 0.7)',
                            borderColor: 'rgba(52, 199, 89, 1)',
                            borderWidth: 2,
                            borderRadius: 5
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'CO₂ Reduction (tons)'
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                position: 'top',
                            }
                        },
                        animation: {
                            duration: 2000,
                            easing: 'easeOutQuart'
                        }
                    }
                });
            }
            
            function showPricingPlans() {
                // Update step indicator
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step3').classList.add('active');
                
                // Show pricing plans
                pricingPlans.style.display = 'flex';
                
                // Scroll to pricing plans
                pricingPlans.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>