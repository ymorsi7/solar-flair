<!DOCTYPE html>
<html>
<head>
    <title>SolarSage AI Agent</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { 
            padding-top: 20px; 
            background-color: #f8f9fa;
        }
        .solar-header { 
            background: linear-gradient(135deg, #1e5799 0%, #207cca 100%);
            color: white;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .card {
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            border: none;
            border-radius: 10px;
        }
        .card-header {
            border-radius: 10px 10px 0 0 !important;
            font-weight: bold;
        }
        .result-card {
            display: none;
            transition: all 0.3s ease;
        }
        .loader {
            display: none;
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #map {
            height: 300px;
            border-radius: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .verified-badge {
            background-color: #28a745;
            color: white;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 12px;
            margin-left: 8px;
        }
        .pricing-card {
            text-align: center;
            transition: transform 0.3s;
        }
        .pricing-card:hover {
            transform: translateY(-5px);
        }
        .price {
            font-size: 2.5rem;
            font-weight: bold;
        }
        .price-period {
            font-size: 0.9rem;
            color: #6c757d;
        }
        .feature-list {
            list-style: none;
            padding-left: 0;
            margin-top: 20px;
        }
        .feature-list li {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        .feature-list li:last-child {
            border-bottom: none;
        }
        .feature-list li::before {
            content: "✓";
            color: #28a745;
            margin-right: 8px;
        }
        .step-indicator {
            display: flex;
            margin: 30px 0;
        }
        .step {
            flex: 1;
            text-align: center;
            padding: 10px;
            position: relative;
            color: #6c757d;
        }
        .step.active {
            color: #007bff;
            font-weight: bold;
        }
        .step:not(:last-child):after {
            content: "";
            position: absolute;
            top: 50%;
            right: 0;
            width: 100%;
            height: 2px;
            background: #e9ecef;
            z-index: -1;
        }
        .step-number {
            display: inline-block;
            width: 30px;
            height: 30px;
            line-height: 30px;
            border-radius: 50%;
            background: #e9ecef;
            margin-bottom: 5px;
        }
        .step.active .step-number {
            background: #007bff;
            color: white;
        }
        .tab-content {
            padding: 20px;
        }
        .chart-container {
            height: 300px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="solar-header text-center">
            <h1>SolarSage AI Agent</h1>
            <p class="lead">Complete solar advisory service powered by Melissa Data and AI</p>
        </div>
        
        <div class="row justify-content-center">
            <div class="col-md-8">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Enter Your Address</h5>
                        <div class="mb-3">
                            <input type="text" class="form-control" id="addressInput" 
                                   placeholder="e.g. 134 Denslow Ave, Los Angeles, CA">
                        </div>
                        <button class="btn btn-primary" id="assessBtn">Get Solar Assessment</button>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="step-indicator" id="stepIndicator">
            <div class="step active" id="step1">
                <div class="step-number">1</div>
                <div>Address</div>
            </div>
            <div class="step" id="step2">
                <div class="step-number">2</div>
                <div>Assessment</div>
            </div>
            <div class="step" id="step3">
                <div class="step-number">3</div>
                <div>Proposal</div>
            </div>
            <div class="step" id="step4">
                <div class="step-number">4</div>
                <div>Installers</div>
            </div>
        </div>
        
        <div class="loader" id="loader"></div>
        
        <div class="row result-card" id="assessmentResult">
            <div class="col-12">
                <div class="card">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0">Solar Assessment Results</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-md-6">
                                <div id="map"></div>
                                <p class="mt-2 text-center" id="addressDisplay"></p>
                            </div>
                            <div class="col-md-6">
                                <ul class="nav nav-tabs" id="myTab" role="tablist">
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link active" id="system-tab" data-bs-toggle="tab" data-bs-target="#system" type="button" role="tab">System</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="financial-tab" data-bs-toggle="tab" data-bs-target="#financial" type="button" role="tab">Financial</button>
                                    </li>
                                    <li class="nav-item" role="presentation">
                                        <button class="nav-link" id="environmental-tab" data-bs-toggle="tab" data-bs-target="#environmental" type="button" role="tab">Environmental</button>
                                    </li>
                                </ul>
                                <div class="tab-content" id="myTabContent">
                                    <div class="tab-pane fade show active" id="system" role="tabpanel">
                                        <div class="row">
                                            <div class="col-6">
                                                <p><strong>Annual Production:</strong><br><span id="annualKwh" class="fs-4">7,500</span> kWh</p>
                                                <p><strong>System Size:</strong><br><span id="systemSize" class="fs-4">5.0</span> kW</p>
                                            </div>
                                            <div class="col-6">
                                                <p><strong>Panel Count:</strong><br><span id="panelCount" class="fs-4">14</span> panels</p>
                                                <p><strong>Optimal Tilt:</strong><br><span id="bestTilt" class="fs-4">20°</span></p>
                                            </div>
                                        </div>
                                        <p><strong>Recommended Panel Type:</strong><br><span id="bestMaterial">Monocrystalline</span></p>
                                        <p><strong>Roof Details:</strong><br><span id="roofArea">85</span> m² usable area, <span id="shadePct">15</span>% shade</p>
                                    </div>
                                    <div class="tab-pane fade" id="financial" role="tabpanel">
                                        <div class="row">
                                            <div class="col-6">
                                                <p><strong>System Cost:</strong><br>$<span id="systemCost" class="fs-4">14,750</span></p>
                                                <p><strong>Incentives:</strong><br>$<span id="incentives" class="fs-4">4,425</span></p>
                                                <p><strong>Net Cost:</strong><br>$<span id="netCost" class="fs-4">10,325</span></p>
                                            </div>
                                            <div class="col-6">
                                                <p><strong>Annual Savings:</strong><br>$<span id="annualSavings" class="fs-4">1,725</span></p>
                                                <p><strong>Payback Period:</strong><br><span id="paybackYears" class="fs-4">6.0</span> years</p>
                                                <p><strong>25-Year ROI:</strong><br><span id="roi" class="fs-4">319</span>%</p>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="tab-pane fade" id="environmental" role="tabpanel">
                                        <p><strong>CO₂ Reduction:</strong><br><span id="co2Reduction" class="fs-4">5,250</span> kg/year</p>
                                        <p><strong>Equivalent to:</strong></p>
                                        <ul>
                                            <li><span id="treesEquivalent" class="fs-4">242</span> trees planted yearly</li>
                                            <li><span id="carEquivalent" class="fs-4">1.1</span> cars taken off the road</li>
                                        </ul>
                                        <div class="chart-container">
                                            <canvas id="environmentalChart"></canvas>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <hr>
                        
                        <div class="row mt-3">
                            <div class="col-12">
                                <h5>Next Steps</h5>
                                <div id="nextSteps" class="list-group"></div>
                            </div>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <button class="btn btn-success" id="proposalBtn">Generate Proposal</button>
                            <button class="btn btn-outline-primary ms-2" id="findInstallersBtn">Find Installers</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row result-card" id="pricingPlans">
            <div class="col-12 mb-4">
                <h3 class="text-center">Choose Your Plan</h3>
                <p class="text-center text-muted">Unlock premium features with our paid plans</p>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card">
                    <div class="card-body">
                        <h5 class="card-title">Free</h5>
                        <p class="price">$0</p>
                        <p class="price-period">forever</p>
                        <ul class="feature-list">
                            <li>Basic solar assessment</li>
                            <li>Estimated ROI calculation</li>
                            <li>3 assessments per month</li>
                        </ul>
                        <button class="btn btn-outline-primary mt-3 w-100">Current Plan</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card" style="border: 2px solid #007bff;">
                    <div class="card-body">
                        <h5 class="card-title">Premium</h5>
                        <p class="price">$9.99</p>
                        <p class="price-period">per month</p>
                        <ul class="feature-list">
                            <li>Detailed solar assessment</li>
                            <li>Custom proposal generation</li>
                            <li>Installer matching</li>
                            <li>Unlimited assessments</li>
                        </ul>
                        <button class="btn btn-primary mt-3 w-100" id="upgradePremiumBtn">Upgrade Now</button>
                    </div>
                </div>
            </div>
            <div class="col-md-4">
                <div class="card pricing-card">
                    <div class="card-body">
                        <h5 class="card-title">Business</h5>
                        <p class="price">$49.99</p>
                        <p class="price-period">per month</p>
                        <ul class="feature-list">
                            <li>Everything in Premium</li>
                            <li>Financing options</li>
                            <li>System monitoring</li>
                            <li>API access</li>
                            <li>White-label reports</li>
                        </ul>
                        <button class="btn btn-outline-primary mt-3 w-100">Contact Sales</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const addressInput = document.getElementById('addressInput');
            const assessBtn = document.getElementById('assessBtn');
            const proposalBtn = document.getElementById('proposalBtn');
            const findInstallersBtn = document.getElementById('findInstallersBtn');
            const upgradePremiumBtn = document.getElementById('upgradePremiumBtn');
            const loader = document.getElementById('loader');
            const assessmentResult = document.getElementById('assessmentResult');
            const pricingPlans = document.getElementById('pricingPlans');
            
            // Set up event listeners
            assessBtn.addEventListener('click', runAssessment);
            proposalBtn.addEventListener('click', showPricingPlans);
            findInstallersBtn.addEventListener('click', showPricingPlans);
            upgradePremiumBtn.addEventListener('click', function() {
                alert('This is a demo for the hackathon. In a real implementation, this would process a payment and upgrade your account.');
            });
            
            // Pre-fill the address for demo purposes
            addressInput.value = "134 Denslow Ave, Los Angeles, CA";
            
            async function runAssessment() {
                const address = addressInput.value.trim();
                if (!address) {
                    alert('Please enter an address');
                    return;
                }
                
                // Show loader
                loader.style.display = 'block';
                assessmentResult.style.display = 'none';
                pricingPlans.style.display = 'none';
                
                // Update step indicator
                document.getElementById('step1').classList.remove('active');
                document.getElementById('step2').classList.add('active');
                
                try {
                    // Simulate API call with a delay
                    setTimeout(() => {
                        // Get results from your actual test-hybrid-melissa.js script
                        const results = {
                            std: "134 Denslow Ave, Los Angeles CA 90049-3221",
                            lat: 34.0735812,
                            lng: -118.4576362,
                            annualKwh: 7500,
                            paybackYears: 4.3,
                            bestTilt: 20,
                            bestMaterial: "Monocrystalline",
                            melissaVerified: true,
                            // Additional data for the enhanced UI
                            systemSize: 5.0,
                            panelCount: 14,
                            roofDetails: {
                                usableAreaM2: 85,
                                shadePct: 15
                            },
                            financials: {
                                systemCost: 14750,
                                incentives: 4425,
                                netCost: 10325,
                                annualSavings: 1725,
                                roi25Year: 319
                            },
                            environmental: {
                                co2ReductionKg: 5250,
                                treesEquivalent: 242,
                                carEquivalent: 1.1
                            },
                            nextSteps: [
                                {
                                    action: "Generate Custom Proposal",
                                    description: "Create a detailed solar proposal with system design and financials",
                                    toolId: "solar-proposal"
                                },
                                {
                                    action: "Find Local Installers",
                                    description: "Connect with top-rated solar installers in your area",
                                    toolId: "solar-installer"
                                },
                                {
                                    action: "Explore Financing Options",
                                    description: "Compare solar loans, leases, and PPAs",
                                    toolId: "solar-financing"
                                }
                            ]
                        };
                        
                        displayResults(results);
                        
                        // Hide loader
                        loader.style.display = 'none';
                        assessmentResult.style.display = 'block';
                    }, 2000);
                } catch (error) {
                    console.error('Error:', error);
                    alert('An error occurred. Please try again.');
                    loader.style.display = 'none';
                }
            }
            
            function displayResults(results) {
                // Display address with Melissa verification badge
                document.getElementById('addressDisplay').innerHTML = 
                    results.std + (results.melissaVerified ? ' <span class="verified-badge">Melissa Verified</span>' : '');
                
                // Display system details
                document.getElementById('annualKwh').textContent = results.annualKwh.toLocaleString();
                document.getElementById('systemSize').textContent = results.systemSize;
                document.getElementById('panelCount').textContent = results.panelCount;
                document.getElementById('bestTilt').textContent = results.bestTilt;
                document.getElementById('bestMaterial').textContent = results.bestMaterial;
                document.getElementById('roofArea').textContent = results.roofDetails.usableAreaM2;
                document.getElementById('shadePct').textContent = results.roofDetails.shadePct;
                
                // Display financials
                document.getElementById('systemCost').textContent = results.financials.systemCost.toLocaleString();
                document.getElementById('incentives').textContent = results.financials.incentives.toLocaleString();
                document.getElementById('netCost').textContent = results.financials.netCost.toLocaleString();
                document.getElementById('annualSavings').textContent = results.financials.annualSavings.toLocaleString();
                document.getElementById('paybackYears').textContent = results.paybackYears;
                document.getElementById('roi').textContent = results.financials.roi25Year;
                
                // Display environmental impact
                document.getElementById('co2Reduction').textContent = results.environmental.co2ReductionKg.toLocaleString();
                document.getElementById('treesEquivalent').textContent = results.environmental.treesEquivalent;
                document.getElementById('carEquivalent').textContent = results.environmental.carEquivalent;
                
                // Display next steps
                const nextStepsContainer = document.getElementById('nextSteps');
                nextStepsContainer.innerHTML = '';
                
                results.nextSteps.forEach(step => {
                    const item = document.createElement('a');
                    item.className = 'list-group-item list-group-item-action';
                    item.href = '#';
                    item.innerHTML = `<strong>${step.action}</strong>: ${step.description}`;
                    item.addEventListener('click', showPricingPlans);
                    nextStepsContainer.appendChild(item);
                });
                
                // Initialize map
                const map = L.map('map').setView([results.lat, results.lng], 15);
                L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                    attribution: '&copy; OpenStreetMap contributors'
                }).addTo(map);
                L.marker([results.lat, results.lng]).addTo(map)
                    .bindPopup(results.std)
                    .openPopup();
                
                // Create environmental impact chart
                const ctx = document.getElementById('environmentalChart').getContext('2d');
                new Chart(ctx, {
                    type: 'bar',
                    data: {
                        labels: ['Year 1', 'Year 5', 'Year 10', 'Year 15', 'Year 20', 'Year 25'],
                        datasets: [{
                            label: 'CO₂ Reduction (tons)',
                            data: [5.25, 26.25, 52.5, 78.75, 105, 131.25],
                            backgroundColor: 'rgba(40, 167, 69, 0.7)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        scales: {
                            y: {
                                beginAtZero: true,
                                title: {
                                    display: true,
                                    text: 'CO₂ Reduction (tons)'
                                }
                            }
                        }
                    }
                });
            }
            
            function showPricingPlans() {
                // Update step indicator
                document.getElementById('step2').classList.remove('active');
                document.getElementById('step3').classList.add('active');
                
                // Show pricing plans
                pricingPlans.style.display = 'flex';
                
                // Scroll to pricing plans
                pricingPlans.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>